---
phase: 03-memory-advanced-mem0-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ta_lab2/tools/ai_orchestrator/memory/mem0_config.py
  - src/ta_lab2/tools/ai_orchestrator/memory/mem0_client.py
  - tests/orchestrator/test_mem0_client.py
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Mem0 client can search existing 3,763 memories without re-embedding"
    - "Mem0 client accesses existing ChromaDB with 3,763 memories"
    - "Mem0 search returns results from existing embeddings"
    - "No re-embedding of existing memories required"
  artifacts:
    - path: "src/ta_lab2/tools/ai_orchestrator/memory/mem0_config.py"
      provides: "Mem0 configuration using ChromaDB backend"
      exports: ["Mem0Config", "create_mem0_config"]
    - path: "src/ta_lab2/tools/ai_orchestrator/memory/mem0_client.py"
      provides: "Mem0 client wrapper with singleton pattern"
      exports: ["Mem0Client", "get_mem0_client"]
    - path: "tests/orchestrator/test_mem0_client.py"
      provides: "Mem0 client tests"
      min_lines: 50
  key_links:
    - from: "mem0_config.py"
      to: "existing ChromaDB path"
      via: "vector_store.config.path"
      pattern: "chromadb.*path"
    - from: "mem0_client.py"
      to: "Memory.from_config"
      via: "mem0ai library"
      pattern: "Memory\\.from_config"
---

<objective>
Integrate Mem0 as intelligence layer on top of existing ChromaDB

Purpose: Mem0 provides LLM-powered conflict detection, duplicate prevention, and memory intelligence without requiring re-embedding of existing 3,763 memories. By configuring Mem0 to use ChromaDB as its vector backend, we preserve all Phase 2 work while gaining Mem0's features.

Output: Mem0 client wrapper that accesses existing ChromaDB memories, ready for conflict detection and health monitoring in subsequent plans.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-memory-advanced-mem0-migration/03-RESEARCH.md

# Phase 2 artifacts this plan depends on
@src/ta_lab2/tools/ai_orchestrator/config.py
@src/ta_lab2/tools/ai_orchestrator/memory/client.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Mem0 and create configuration module</name>
  <files>
    src/ta_lab2/tools/ai_orchestrator/memory/mem0_config.py
    pyproject.toml (or requirements if applicable)
  </files>
  <action>
    1. Install mem0ai package: `pip install mem0ai`

    2. Create mem0_config.py with:
       - Mem0Config dataclass with vector_store, llm, and embedder settings
       - create_mem0_config() factory that returns dict for Memory.from_config()
       - Configuration must use:
         - vector_store.provider = "chromadb"
         - vector_store.config.path = existing ChromaDB path from OrchestratorConfig
         - vector_store.config.collection_name = "project_memories"
         - llm.provider = "openai"
         - llm.config.model = "gpt-4o-mini" (for conflict detection)
         - embedder.provider = "openai"
         - embedder.config.model = "text-embedding-3-small" (MUST match Phase 2 for 1536-dim compatibility)
       - Function to load API key from environment (OPENAI_API_KEY)
       - Validation that ChromaDB path exists

    3. Export: Mem0Config, create_mem0_config

    IMPORTANT: The embedder MUST be text-embedding-3-small to match existing 1536-dimension embeddings. Using a different model will cause dimension mismatch errors.
  </action>
  <verify>
    python -c "from ta_lab2.tools.ai_orchestrator.memory.mem0_config import create_mem0_config; cfg = create_mem0_config(); print(cfg['embedder']['config']['model'])"

    Output should be: text-embedding-3-small
  </verify>
  <done>
    Mem0 configuration module exists with ChromaDB backend settings and correct embedding model (text-embedding-3-small)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Mem0 client wrapper with singleton pattern</name>
  <files>
    src/ta_lab2/tools/ai_orchestrator/memory/mem0_client.py
  </files>
  <action>
    1. Create Mem0Client class wrapping mem0.Memory:
       - __init__ accepts optional config dict (uses create_mem0_config() if not provided)
       - Lazy initialization: Memory.from_config() called on first access
       - Methods:
         - add(messages: list[dict], user_id: str, metadata: dict = None, infer: bool = True) -> dict
           - infer=True enables conflict detection (Mem0's LLM resolver)
         - search(query: str, user_id: str = None, filters: dict = None, limit: int = 10) -> list
         - update(memory_id: str, data: str, metadata: dict = None) -> dict
         - delete(memory_id: str) -> dict
         - get_all(user_id: str = None) -> list
       - Property: memory_count -> int (wraps underlying collection count)

    2. Singleton pattern:
       - Module-level _mem0_client: Optional[Mem0Client] = None
       - get_mem0_client() -> Mem0Client (creates if needed)
       - reset_mem0_client() -> None (for testing, sets singleton to None)

    3. Error handling:
       - Wrap Mem0 operations in try/except
       - Log errors with memory IDs for debugging
       - Re-raise with descriptive message

    4. Update memory/__init__.py to export: Mem0Client, get_mem0_client, reset_mem0_client
  </action>
  <verify>
    python -c "from ta_lab2.tools.ai_orchestrator.memory import Mem0Client; print('Mem0Client imported successfully')"
  </verify>
  <done>
    Mem0Client wrapper exists with singleton pattern, lazy initialization, and CRUD methods with infer support
  </done>
</task>

<task type="auto">
  <name>Task 3: Validate Mem0 accesses existing ChromaDB memories</name>
  <files>
    tests/orchestrator/test_mem0_client.py
  </files>
  <action>
    1. Create test file with comprehensive tests:

       Test configuration:
       - test_create_mem0_config_returns_dict: Verify config dict structure
       - test_config_uses_correct_chromadb_path: Path matches OrchestratorConfig
       - test_config_uses_text_embedding_3_small: Embedder model is correct
       - test_config_uses_gpt4o_mini_for_llm: LLM model for conflict detection

       Test singleton:
       - test_get_mem0_client_returns_instance: get_mem0_client() returns Mem0Client
       - test_singleton_returns_same_instance: Second call returns same instance
       - test_reset_clears_singleton: reset_mem0_client() clears the instance

       Test client methods (use mocks):
       - test_add_calls_underlying_memory: Add passes through to Memory.add()
       - test_search_returns_results: Search returns list from Memory.search()
       - test_infer_true_by_default: Verify infer=True is default for conflict detection

       Integration test (if OPENAI_API_KEY and ChromaDB available):
       - test_mem0_can_query_existing_chromadb: Search returns results from existing 3,763 memories
       - Mark with @pytest.mark.integration and skip if env vars missing

    2. Run tests: pytest tests/orchestrator/test_mem0_client.py -v

    3. Verify all tests pass
  </action>
  <verify>
    pytest tests/orchestrator/test_mem0_client.py -v --tb=short

    All tests should pass. Integration test may skip if OPENAI_API_KEY not available.
  </verify>
  <done>
    Test suite passes confirming Mem0 client configuration and singleton pattern work correctly
  </done>
</task>

</tasks>

<verification>
1. mem0ai package installed and importable
2. Mem0 configuration uses existing ChromaDB path (C:/Users/asafi/Documents/ProjectTT/ChatGPT/20251228/out/chromadb)
3. Embedder model is text-embedding-3-small (1536-dim, matching Phase 2)
4. Mem0Client singleton works correctly
5. All tests pass
</verification>

<success_criteria>
- Mem0 client wrapper created with singleton pattern
- Configuration correctly targets existing ChromaDB (no new database created)
- Embedder model matches Phase 2 (text-embedding-3-small, 1536-dim)
- Test suite validates configuration and client methods
- Ready for conflict detection plan (03-02)
</success_criteria>

<output>
After completion, create `.planning/phases/03-memory-advanced-mem0-migration/03-01-SUMMARY.md`
</output>
