---
phase: 17-verification-validation
plan: 08
type: execute
wave: 2
depends_on: ["17-06", "17-07"]
files_modified:
  - tests/test_circular_deps.py
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All 5 import-linter contracts pass"
    - "Zero architectural violations remain"
    - "CI circular-dependencies job will pass"
  artifacts:
    - path: "tests/test_circular_deps.py"
      provides: "pytest wrapper for import-linter validation"
      min_lines: 30
  key_links:
    - from: "tests/test_circular_deps.py"
      to: "lint-imports command"
      via: "subprocess.run"
      pattern: "subprocess\\.run.*lint-imports"
---

<objective>
Verify all import-linter contracts pass after gap closure refactoring

Purpose: After Plans 17-06 and 17-07 complete their refactoring, this plan validates that ALL import-linter contracts pass. This ensures VAL-02 (dependency graph validation) is fully satisfied and the CI circular-dependencies job will succeed.

Output: Clean import-linter run with zero violations, test passes
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/17-verification-validation/17-VERIFICATION.md

# Import-linter configuration
@pyproject.toml

# Test file that wraps import-linter
@tests/test_circular_deps.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full import-linter validation</name>
  <files></files>
  <action>
    Run import-linter to validate all 5 contracts:

    ```bash
    lint-imports
    ```

    Expected output should show all contracts PASSED:
    1. "No circular dependencies between ta_lab2 layers" - PASSED
    2. "Tools layer doesn't import from scripts layer" - PASSED
    3. "Features layer doesn't import from scripts layer" - PASSED
    4. "Tools layer doesn't import from features layer" - PASSED (fixed by 17-06)
    5. "No circular dependency between regimes and pipelines" - PASSED (fixed by 17-07)

    If ANY contract fails, document the remaining violation for investigation.

    The 3 original violations were:
    - tools->features: ema_runners.py (FIXED by 17-06 - moved to scripts)
    - regimes->pipelines: run_btc_pipeline.py (FIXED by 17-07 - moved to scripts)
    - pipelines->regimes: btc_pipeline.py imports comovement (ALLOWED by layers contract - pipelines at same level as regimes)

    Note: The pipelines->regimes import is actually ALLOWED by the layers contract which places `ta_lab2.pipelines | ta_lab2.backtests` at the same level as `ta_lab2.signals | ta_lab2.regimes | ta_lab2.analysis`. Same-level imports are permitted; only downward imports are forbidden.
  </action>
  <verify>
    ```bash
    # Full import-linter run - should exit 0
    lint-imports
    echo "Exit code: $?"
    # Should output: Exit code: 0

    # Count violations
    lint-imports 2>&1 | grep -c "BROKEN"
    # Should output: 0
    ```
  </verify>
  <done>lint-imports exits with code 0, zero BROKEN contracts</done>
</task>

<task type="auto">
  <name>Task 2: Run test_circular_deps.py to confirm pytest integration</name>
  <files></files>
  <action>
    The test file `tests/test_circular_deps.py` wraps import-linter in pytest.
    Run it to confirm the test passes:

    ```bash
    pytest tests/test_circular_deps.py -v
    ```

    Expected: test_no_circular_dependencies PASSED

    This test is what the CI workflow runs, so passing it locally confirms CI will succeed.
  </action>
  <verify>
    ```bash
    pytest tests/test_circular_deps.py -v
    # Should show: PASSED for test_no_circular_dependencies
    ```
  </verify>
  <done>pytest tests/test_circular_deps.py passes</done>
</task>

<task type="auto">
  <name>Task 3: Update VERIFICATION.md to mark VAL-02 as satisfied</name>
  <files>
    .planning/phases/17-verification-validation/17-VERIFICATION.md
  </files>
  <action>
    Update the VERIFICATION.md frontmatter and body to reflect that all gaps are now closed:

    1. Change frontmatter:
    ```yaml
    status: verified  # was: gaps_found
    score: 4/4 requirements verified  # was: 3/4
    gaps: []  # was: list with VAL-02 gap
    ```

    2. Update the Observable Truths table:
    - Row 2: Change "No circular dependencies detected" from "FAILED" to "VERIFIED"
    - Evidence: "All 5 import-linter contracts pass after gap closure (17-06, 17-07, 17-08)"

    3. Update Requirements Coverage table:
    - VAL-02: Change from "PARTIAL" to "SATISFIED"
    - Remove blocking issue text

    4. Remove or update the "Gaps Summary" section to indicate gaps are closed

    5. Update verification timestamp
  </action>
  <verify>
    ```bash
    # Check frontmatter shows verified status
    head -10 .planning/phases/17-verification-validation/17-VERIFICATION.md | grep "status: verified"

    # Check score
    head -10 .planning/phases/17-verification-validation/17-VERIFICATION.md | grep "4/4"
    ```
  </verify>
  <done>VERIFICATION.md shows status: verified with score 4/4 and no gaps</done>
</task>

</tasks>

<verification>
- [ ] lint-imports exits with code 0
- [ ] All 5 contracts show PASSED
- [ ] pytest test_circular_deps.py passes
- [ ] VERIFICATION.md updated to reflect full satisfaction
- [ ] VAL-02 requirement now SATISFIED
</verification>

<success_criteria>
1. `lint-imports` shows 0 violations (exit code 0)
2. `pytest tests/test_circular_deps.py` passes
3. VERIFICATION.md frontmatter shows `status: verified` and `score: 4/4`
4. Phase 17 is now fully complete with all requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/17-verification-validation/17-08-SUMMARY.md`
</output>
