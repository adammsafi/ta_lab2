---
phase: 13-documentation-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ta_lab2/tools/docs/__init__.py
  - src/ta_lab2/tools/docs/convert_docx.py
  - src/ta_lab2/tools/docs/convert_excel.py
autonomous: true

must_haves:
  truths:
    - "DOCX files can be converted to Markdown with YAML front matter"
    - "Excel files can be converted to Markdown tables"
    - "Conversion utilities follow established project patterns"
  artifacts:
    - path: "src/ta_lab2/tools/docs/__init__.py"
      provides: "Module exports for docs tooling"
      min_lines: 10
    - path: "src/ta_lab2/tools/docs/convert_docx.py"
      provides: "DOCX to Markdown conversion with metadata"
      exports: ["convert_docx_to_markdown", "extract_docx_metadata"]
    - path: "src/ta_lab2/tools/docs/convert_excel.py"
      provides: "Excel to Markdown table conversion"
      exports: ["convert_excel_to_markdown"]
  key_links:
    - from: "src/ta_lab2/tools/docs/convert_docx.py"
      to: "pypandoc"
      via: "import pypandoc"
      pattern: "pypandoc\\.convert_file"
    - from: "src/ta_lab2/tools/docs/convert_excel.py"
      to: "pandas"
      via: "import pandas"
      pattern: "pd\\.read_excel.*to_markdown"
---

<objective>
Create reusable document conversion utilities for DOCX and Excel files.

Purpose: Establish conversion infrastructure following Phase 12's archive tooling patterns. Utilities will be used by subsequent plans to batch-convert ProjectTT documentation.
Output: Python modules in src/ta_lab2/tools/docs/ with convert_docx.py and convert_excel.py
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-documentation-consolidation/13-CONTEXT.md
@.planning/phases/13-documentation-consolidation/13-RESEARCH.md

# Existing patterns to follow
@src/ta_lab2/tools/archive/types.py
@src/ta_lab2/tools/archive/manifest.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create convert_docx.py with YAML front matter support</name>
  <files>src/ta_lab2/tools/docs/__init__.py, src/ta_lab2/tools/docs/convert_docx.py</files>
  <action>
Create src/ta_lab2/tools/docs/ directory and conversion module for DOCX files.

1. Create __init__.py with exports (similar to archive/__init__.py pattern)

2. Create convert_docx.py implementing:
   - extract_docx_metadata(docx_path: Path) -> dict
     - Uses python-docx to extract core_properties (title, author, created, modified)
     - Falls back to filename for title if not set
     - Returns dict with title, author, created, modified, original_path, original_size_bytes

   - convert_docx_to_markdown(docx_path: Path, output_path: Path, extract_media: bool = True, dry_run: bool = False) -> dict
     - Two-step conversion: DOCX -> HTML (pypandoc) -> Markdown (markdownify)
     - Extract images to output_path.parent / "assets" / output_path.stem
     - Add YAML front matter with metadata from extract_docx_metadata()
     - Return conversion result dict: source, output, metadata, media_dir, media_count

   - ConversionResult dataclass following ArchiveResult pattern:
     - total, converted, skipped, errors, error_paths
     - __str__ for human-readable summary

3. Add logging using project logger pattern

Dependencies to install if not present: pypandoc, markdownify, python-docx
  </action>
  <verify>
    python -c "from ta_lab2.tools.docs import convert_docx_to_markdown, extract_docx_metadata; print('Import OK')"
  </verify>
  <done>
    - convert_docx.py module created with extract_docx_metadata and convert_docx_to_markdown functions
    - Module importable from ta_lab2.tools.docs
    - Functions follow dry-run pattern from archive module
  </done>
</task>

<task type="auto">
  <name>Task 2: Create convert_excel.py for Excel to Markdown tables</name>
  <files>src/ta_lab2/tools/docs/convert_excel.py</files>
  <action>
Create Excel conversion module using pandas.

1. Create convert_excel.py implementing:
   - convert_excel_to_markdown(excel_path: Path, output_path: Path, sheet_names: list = None, include_index: bool = False, dry_run: bool = False) -> dict
     - Read workbook with pd.ExcelFile
     - Convert each sheet to Markdown table using DataFrame.to_markdown(index=False)
     - Handle unnamed columns (replace "Unnamed: X" with empty string)
     - Create H1 heading from filename, H2 heading per sheet
     - Skip empty sheets with logging
     - Add metadata note: "*Converted from: {excel_path.name}*"
     - Return result dict: source, output, sheets_converted, total_sheets, sheet_stats

   - batch_convert_excel(input_dir: Path, output_dir: Path, pattern: str = "*.xlsx", dry_run: bool = False) -> ConversionResult
     - Batch convert all Excel files matching pattern
     - Skip existing files (idempotent)
     - Track progress with logging
     - Return ConversionResult with totals

2. Add to __init__.py exports

3. Handle edge cases:
   - Multi-sheet workbooks (each sheet as H2 section)
   - Empty sheets (skip with warning)
   - Complex formatting (best effort, note limitations in HTML comment)
  </action>
  <verify>
    python -c "from ta_lab2.tools.docs import convert_excel_to_markdown; print('Import OK')"
  </verify>
  <done>
    - convert_excel.py module created with convert_excel_to_markdown function
    - Handles multi-sheet workbooks correctly
    - Module importable from ta_lab2.tools.docs
  </done>
</task>

</tasks>

<verification>
All verification commands must pass:

```bash
# Import verification
python -c "from ta_lab2.tools.docs import convert_docx_to_markdown, extract_docx_metadata, convert_excel_to_markdown"

# Module structure
ls src/ta_lab2/tools/docs/

# Dependencies available
python -c "import pypandoc; import markdownify; import pandas; from docx import Document"
```
</verification>

<success_criteria>
- [ ] src/ta_lab2/tools/docs/__init__.py exists with module exports
- [ ] convert_docx.py implements DOCX to Markdown with YAML front matter
- [ ] convert_excel.py implements Excel to Markdown tables
- [ ] All functions follow dry-run pattern for safe testing
- [ ] Modules importable from ta_lab2.tools.docs
- [ ] Dependencies installed (pypandoc, markdownify, python-docx)
</success_criteria>

<output>
After completion, create `.planning/phases/13-documentation-consolidation/13-01-SUMMARY.md`
</output>
