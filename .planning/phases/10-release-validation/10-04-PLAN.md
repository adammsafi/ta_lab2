---
phase: 10-release-validation
plan: 04
type: execute
wave: 3
depends_on: [10-02, 10-03]
files_modified:
  - docs/DESIGN.md
  - docs/deployment.md
autonomous: true

must_haves:
  truths:
    - "DESIGN.md explains high-level concepts and data flow"
    - "Deployment guide covers infrastructure setup and environment configuration"
    - "Documentation is complete for v0.4.0 release"
  artifacts:
    - path: "docs/DESIGN.md"
      provides: "High-level system design documentation"
      min_lines: 200
    - path: "docs/deployment.md"
      provides: "Deployment guide with infrastructure setup"
      min_lines: 150
  key_links:
    - from: "docs/DESIGN.md"
      to: "docs/ARCHITECTURE.md"
      via: "reference"
      pattern: "ARCHITECTURE.md"
---

<objective>
Create DESIGN.md and deployment guide documentation

Purpose: Implement documentation requirements for SIG-07. DESIGN.md provides high-level concepts and system overview (complementing existing ARCHITECTURE.md with implementation details). Deployment guide covers infrastructure setup, environment variables, database migrations, and monitoring setup.

Output: Two new documentation files ready for v0.4.0 release
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-release-validation/10-CONTEXT.md
@.planning/phases/10-release-validation/10-RESEARCH.md

# Existing architecture doc (reference for DESIGN.md)
@ARCHITECTURE.md

# Existing README (for context)
@README.md

# Project structure
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DESIGN.md with system overview</name>
  <files>docs/DESIGN.md</files>
  <action>
Create high-level design documentation:

1. **Header and Purpose**:
   ```markdown
   # ta_lab2 System Design

   Version: 0.4.0

   This document describes the high-level design of ta_lab2, including system goals,
   architecture overview, data flow, and key design decisions. For implementation
   details, see [ARCHITECTURE.md](../ARCHITECTURE.md).
   ```

2. **System Goals**:
   - Technical analysis and regime detection for trading
   - Multi-timeframe EMA calculations with unified time model
   - Signal generation (EMA crossover, RSI mean reversion, ATR breakout)
   - Backtesting with reproducibility guarantees
   - AI orchestration for multi-platform task coordination

3. **Architecture Overview** (diagram in text/ASCII):
   ```
   +----------------+     +----------------+     +----------------+
   |   Data Layer   | --> | Feature Layer  | --> | Signal Layer   |
   | (price bars)   |     | (EMAs, vol,    |     | (crossovers,   |
   |                |     |  returns, TA)  |     |  reversions)   |
   +----------------+     +----------------+     +----------------+
           |                      |                      |
           v                      v                      v
   +--------------------------------------------------------+
   |                    Time Model Layer                      |
   |  (dim_timeframe, dim_sessions, calendar alignment)       |
   +--------------------------------------------------------+
   ```

4. **Key Components**:
   - **Time Model**: dim_timeframe (199 TFs), dim_sessions (CRYPTO/EQUITY), calendar vs trading alignment
   - **Feature Pipeline**: Returns, volatility (Parkinson, GK), technical indicators (RSI, MACD, BB)
   - **Signal System**: Database-driven configuration, feature hashing for reproducibility
   - **Memory System**: Mem0 + Qdrant for AI context persistence
   - **Orchestrator**: Multi-platform AI coordination (Claude, ChatGPT, Gemini)

5. **Data Flow**:
   - Describe end-to-end: price data -> EMAs -> features -> signals -> backtest
   - Explain incremental refresh pattern
   - Explain watermark-based dirty window detection

6. **Design Decisions** (reference STATE.md accumulated decisions):
   - Vertical slices over horizontal layers
   - Database-driven configuration (dim_signals, dim_indicators)
   - Feature hashing for reproducibility
   - Three-tier test pattern (real_deps, mixed_deps, mocked_deps)
   - PostgreSQL-backed observability

7. **Quality Attributes**:
   - Reproducibility: Triple-layer verification (deterministic queries, feature hashing, version tracking)
   - Extensibility: Database-driven config for new indicators/signals
   - Testability: Three-tier test infrastructure

8. **References**:
   - Link to ARCHITECTURE.md for implementation details
   - Link to API reference (when available)
   - Link to deployment guide
  </action>
  <verify>File exists with 200+ lines: `wc -l docs/DESIGN.md` shows >= 200</verify>
  <done>DESIGN.md provides high-level system design overview complementing ARCHITECTURE.md</done>
</task>

<task type="auto">
  <name>Task 2: Create deployment guide</name>
  <files>docs/deployment.md</files>
  <action>
Create comprehensive deployment documentation:

1. **Header**:
   ```markdown
   # ta_lab2 Deployment Guide

   Version: 0.4.0

   This guide covers deploying ta_lab2 in development and production environments.
   ```

2. **Prerequisites**:
   - Python 3.10+ (3.11 recommended)
   - PostgreSQL 14+ (16 recommended)
   - Qdrant (for memory system)
   - Git

3. **Installation**:
   ```markdown
   ## Installation

   ### Basic Installation
   pip install -e .

   ### With AI Orchestrator
   pip install -e ".[orchestrator]"

   ### Full Development
   pip install -e ".[all]"
   ```

4. **Environment Variables**:
   | Variable | Required | Description | Example |
   |----------|----------|-------------|---------|
   | TARGET_DB_URL | Yes | PostgreSQL connection string | postgresql://user:pass@localhost:5432/ta_lab2 |
   | TA_LAB2_DB_URL | Alt | Alternative DB URL env var | Same as above |
   | OPENAI_API_KEY | For AI | OpenAI API key | sk-... |
   | ANTHROPIC_API_KEY | For AI | Claude API key | sk-ant-... |
   | GOOGLE_API_KEY | For AI | Gemini API key | AIza... |
   | QDRANT_SERVER_MODE | Memory | true for server mode | true |
   | QDRANT_URL | Memory | Qdrant server URL | http://localhost:6333 |

5. **Database Setup**:
   - Create database: `createdb ta_lab2`
   - Run migrations/DDL:
     ```bash
     # Ensure dimension tables exist
     python -m ta_lab2.scripts.time.ensure_dim_tables

     # Create EMA tables (if not exist)
     psql -f sql/ddl/create_cmc_ema_tables.sql

     # Create signal tables
     psql -f sql/ddl/create_cmc_signals_tables.sql
     ```

6. **Qdrant Setup** (for memory system):
   ```bash
   # Docker (recommended)
   docker run -d --name qdrant \
     -p 6333:6333 \
     -v qdrant_storage:/qdrant/storage \
     qdrant/qdrant

   # Or local binary
   ./qdrant --storage-path ./qdrant_data
   ```

7. **Running Services**:
   - Memory API: `uvicorn ta_lab2.tools.ai_orchestrator.memory.api:app --port 8000`
   - Feature refresh: `python -m ta_lab2.scripts.features.ta_feature refresh --all`
   - Signal generation: `python -m ta_lab2.scripts.signals.run_all_signal_refreshes`

8. **Monitoring Setup**:
   - Health check endpoint: GET /health
   - Observability tables: observability.metrics, observability.traces
   - Alert configuration: TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID

9. **CI/CD Configuration**:
   - Reference .github/workflows/validation.yml
   - Explain PostgreSQL service container setup
   - Coverage thresholds and validation gates

10. **Troubleshooting**:
    - Common issues and solutions
    - Log locations
    - Debug commands
  </action>
  <verify>File exists with 150+ lines: `wc -l docs/deployment.md` shows >= 150</verify>
  <done>Deployment guide covers infrastructure setup, environment variables, and monitoring</done>
</task>

</tasks>

<verification>
1. docs/DESIGN.md exists with system overview and data flow diagrams
2. docs/deployment.md exists with environment variables table
3. Both docs reference each other and ARCHITECTURE.md appropriately
4. Documentation is actionable (commands can be copy-pasted)
</verification>

<success_criteria>
- DESIGN.md explains high-level concepts (200+ lines)
- deployment.md covers all environment variables
- Documentation is complete for v0.4.0 release
- Cross-references between docs are correct
</success_criteria>

<output>
After completion, create `.planning/phases/10-release-validation/10-04-SUMMARY.md`
</output>
