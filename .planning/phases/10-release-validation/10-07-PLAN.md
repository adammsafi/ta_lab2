---
phase: 10-release-validation
plan: 07
type: execute
wave: 5
depends_on: [10-04, 10-05, 10-06]
files_modified:
  - docs/api/memory.md
  - docs/api/orchestrator.md
  - docs/api/ta_lab2.md
  - docs/index.md
autonomous: true

must_haves:
  truths:
    - "API documentation covers all REST endpoints"
    - "CLI commands documented with examples"
    - "Documentation site index page exists"
  artifacts:
    - path: "docs/api/memory.md"
      provides: "Memory API documentation"
      contains: "/api/v1/memory"
    - path: "docs/api/orchestrator.md"
      provides: "Orchestrator CLI documentation"
      contains: "ta-lab2 orchestrator"
    - path: "docs/index.md"
      provides: "Documentation site index"
      min_lines: 50
  key_links:
    - from: "docs/api/memory.md"
      to: "src/ta_lab2/tools/ai_orchestrator/memory/api.py"
      via: "documents"
      pattern: "/api/v1/memory"
---

<objective>
Create API reference documentation and documentation site index

Purpose: Complete the documentation suite for v0.4.0 by creating API reference docs for Memory and Orchestrator, plus the index page for MkDocs site. This enables developers to discover and use the APIs effectively.

Output: API documentation files and documentation site ready for build
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-release-validation/10-CONTEXT.md
@.planning/phases/10-release-validation/10-RESEARCH.md

# Memory API source
@src/ta_lab2/tools/ai_orchestrator/memory/api.py

# Orchestrator CLI source
@src/ta_lab2/tools/ai_orchestrator/cli.py

# MkDocs config (from Plan 06)
# @mkdocs.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Memory API documentation</name>
  <files>docs/api/memory.md</files>
  <action>
Create comprehensive Memory API documentation:

```markdown
# Memory API Reference

The Memory API provides REST endpoints for interacting with the ta_lab2 memory system (Mem0 + Qdrant).

## Base URL

```
http://localhost:8000/api/v1/memory
```

## Authentication

Currently no authentication required (internal use). Future versions may add API key authentication.

## Endpoints

### Search Memories

**POST** `/api/v1/memory/search`

Search for semantically similar memories.

**Request Body:**
```json
{
  "query": "EMA crossover strategy",
  "limit": 10,
  "threshold": 0.7
}
```

**Parameters:**
| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| query | string | Yes | - | Search query text |
| limit | integer | No | 10 | Maximum results to return (1-100) |
| threshold | float | No | 0.7 | Minimum similarity threshold (0.0-1.0) |

**Response:**
```json
{
  "results": [
    {
      "id": "mem_abc123",
      "content": "EMA crossover signals trigger when fast EMA crosses above slow EMA",
      "similarity": 0.89,
      "metadata": {
        "created_at": "2026-01-15T10:30:00Z",
        "tags": ["signal", "ema"]
      }
    }
  ],
  "count": 1
}
```

### Add Memory

**POST** `/api/v1/memory/add`

Add a new memory to the store.

**Request Body:**
```json
{
  "content": "RSI below 30 indicates oversold conditions",
  "metadata": {
    "tags": ["indicator", "rsi"],
    "source": "trading_rules"
  }
}
```

**Response:**
```json
{
  "id": "mem_def456",
  "status": "created"
}
```

### Get Memory by ID

**GET** `/api/v1/memory/{memory_id}`

Retrieve a specific memory by ID.

**Response:**
```json
{
  "id": "mem_abc123",
  "content": "...",
  "metadata": {...}
}
```

### Health Check

**GET** `/api/v1/memory/health`

Check memory system health.

**Response:**
```json
{
  "status": "healthy",
  "checks": {
    "qdrant": "connected",
    "mem0": "initialized"
  },
  "memory_count": 3763
}
```

### Stale Memories

**GET** `/api/v1/memory/health/stale`

List memories not verified in 90+ days.

**Query Parameters:**
| Param | Type | Default | Description |
|-------|------|---------|-------------|
| limit | int | 100 | Maximum results |
| dry_run | bool | true | If false, flags as stale |

### Conflict Resolution

**POST** `/api/v1/memory/conflicts/resolve`

Detect and optionally resolve conflicting memories.

**Request Body:**
```json
{
  "memory_id": "mem_abc123",
  "mode": "detect"
}
```

**Modes:**
- `detect`: Only identify conflicts
- `resolve`: Apply LLM-powered resolution

## Error Responses

All endpoints return standard error format:

```json
{
  "error": "Memory not found",
  "code": "NOT_FOUND",
  "details": {...}
}
```

**Status Codes:**
- 200: Success
- 400: Bad request (invalid parameters)
- 404: Resource not found
- 500: Internal server error

## Running the API

```bash
# Start the Memory API server
uvicorn ta_lab2.tools.ai_orchestrator.memory.api:app --host 0.0.0.0 --port 8000

# With auto-reload for development
uvicorn ta_lab2.tools.ai_orchestrator.memory.api:app --reload
```

## OpenAPI/Swagger

Interactive API documentation available at:
- Swagger UI: `http://localhost:8000/api/docs`
- ReDoc: `http://localhost:8000/api/redoc`
- OpenAPI JSON: `http://localhost:8000/api/openapi.json`
```
  </action>
  <verify>File exists: `test -f docs/api/memory.md && echo "exists"`</verify>
  <done>Memory API documentation covers all endpoints with request/response examples</done>
</task>

<task type="auto">
  <name>Task 2: Create Orchestrator CLI documentation</name>
  <files>docs/api/orchestrator.md</files>
  <action>
Create Orchestrator CLI documentation:

```markdown
# Orchestrator CLI Reference

The ta_lab2 orchestrator provides command-line tools for AI task coordination and quota management.

## Installation

```bash
pip install -e ".[orchestrator]"
```

## Commands

### Submit Task

Submit a task to the AI orchestrator.

```bash
ta-lab2 orchestrator submit "Analyze BTC price trends for Q1 2026" \
  --platform gemini \
  --timeout 300
```

**Options:**
| Option | Type | Default | Description |
|--------|------|---------|-------------|
| --platform | string | auto | Target platform (claude/chatgpt/gemini/auto) |
| --timeout | int | 300 | Timeout in seconds |
| --priority | int | 5 | Task priority (1=highest, 10=lowest) |
| --output | string | - | Output file path |

### Batch Submit

Submit multiple tasks in parallel.

```bash
ta-lab2 orchestrator batch tasks.json \
  --parallel 5 \
  --output results/
```

**tasks.json format:**
```json
[
  {"prompt": "Task 1", "platform": "gemini"},
  {"prompt": "Task 2", "platform": "auto"}
]
```

### Check Status

Check task or batch status.

```bash
# Single task
ta-lab2 orchestrator status task_gemini_20260201_abc123

# Batch
ta-lab2 orchestrator status --batch batch_20260201_xyz789
```

### Quota Commands

#### View Quota

```bash
ta-lab2 orchestrator quota
```

Output:
```
Platform      Used    Limit    Remaining    Reset
-----------   -----   ------   ----------   ---------------
Gemini        450     1500     1050         2026-02-02 00:00 UTC
ChatGPT       $2.50   $100     $97.50       2026-03-01 00:00 UTC
Claude        $1.20   $50      $48.80       2026-03-01 00:00 UTC
```

#### Reserve Quota

```bash
ta-lab2 orchestrator quota reserve --platform gemini --amount 100
```

#### Check and Reserve

```bash
ta-lab2 orchestrator quota check-and-reserve --platform gemini --amount 50
```

### Cost Commands

#### View Costs

```bash
ta-lab2 orchestrator costs --period today
ta-lab2 orchestrator costs --period week
ta-lab2 orchestrator costs --period month
```

#### Cost by Platform

```bash
ta-lab2 orchestrator costs --group-by platform
```

### Chain Commands

#### View Task Chain

```bash
ta-lab2 orchestrator chain task_20260201_abc123
```

Shows task genealogy (parent -> child relationships).

## Configuration

### Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| OPENAI_API_KEY | For ChatGPT | OpenAI API key |
| ANTHROPIC_API_KEY | For Claude | Anthropic API key |
| GOOGLE_API_KEY | For Gemini | Google AI API key |
| ORCHESTRATOR_DB_PATH | No | SQLite path for cost tracking (default: .orchestrator/costs.db) |

### Cost Tiers

The orchestrator routes tasks based on cost tiers:

1. **Tier 1 (Free)**: Gemini free tier (1500 req/day)
2. **Tier 2 (Subscription)**: ChatGPT Plus, Claude Pro
3. **Tier 3 (Paid API)**: Direct API calls (per-token billing)

## Examples

### Basic Task Submission

```bash
# Auto-route (uses cheapest available)
ta-lab2 orchestrator submit "Summarize this document"

# Specific platform
ta-lab2 orchestrator submit "Generate code" --platform claude
```

### Parallel Batch Processing

```bash
# Create batch file
cat > batch.json << EOF
[
  {"prompt": "Analyze asset 1", "context": {"asset_id": 1}},
  {"prompt": "Analyze asset 2", "context": {"asset_id": 2}},
  {"prompt": "Analyze asset 3", "context": {"asset_id": 3}}
]
EOF

# Run batch with 3 parallel workers
ta-lab2 orchestrator batch batch.json --parallel 3 --output results/
```

### Task with Memory Context

```bash
# Task that uses memory for context
ta-lab2 orchestrator submit "Continue the EMA analysis" \
  --memory-query "EMA crossover BTC" \
  --memory-limit 5
```

## Troubleshooting

### Quota Exhausted

```
Error: All platforms exhausted. Tried: gemini, chatgpt, claude
```

**Solution:** Wait for quota reset or add API credits.

### Rate Limited

```
Error: Rate limited by OpenAI. Retrying in 32s...
```

**Solution:** Automatic retry with exponential backoff. No action needed.

### Platform Unavailable

```
Error: Platform claude not available. Routing to fallback.
```

**Solution:** Automatic fallback to next tier. Check API key if persistent.
```
  </action>
  <verify>File exists: `test -f docs/api/orchestrator.md && echo "exists"`</verify>
  <done>Orchestrator CLI documentation covers all commands with examples</done>
</task>

<task type="auto">
  <name>Task 3: Create documentation site index</name>
  <files>docs/index.md, docs/api/__init__.md</files>
  <action>
Create documentation site index page (based on README content):

1. `docs/index.md`:
   - Copy the tiered README content from Plan 05
   - Adjust internal links for MkDocs structure (relative paths)
   - Add "Documentation Navigation" section at bottom:
     ```markdown
     ## Documentation

     - **[Design Overview](DESIGN.md)** - High-level system concepts and data flow
     - **[Architecture](ARCHITECTURE.md)** - Implementation details and schemas
     - **[Deployment Guide](deployment.md)** - Setup and configuration
     - **[API Reference](api/memory.md)** - REST and CLI documentation
     - **[Changelog](CHANGELOG.md)** - Version history
     ```

2. `docs/api/__init__.md` (empty file for directory):
   - Just a placeholder so docs/api/ is recognized

3. Ensure all cross-references use relative paths:
   - `../ARCHITECTURE.md` becomes `ARCHITECTURE.md`
   - `docs/deployment.md` becomes `deployment.md`

Note: MkDocs expects docs/ as root, so links should be relative to that.
  </action>
  <verify>File exists: `test -f docs/index.md && echo "exists"`</verify>
  <done>Documentation site index ready with navigation to all sections</done>
</task>

</tasks>

<verification>
1. docs/api/memory.md documents all Memory API endpoints
2. docs/api/orchestrator.md documents all CLI commands
3. docs/index.md exists and has navigation section
4. All internal links use correct relative paths
5. `mkdocs build` succeeds (if mkdocs installed)
</verification>

<success_criteria>
- Memory API docs cover search, add, health, conflict endpoints
- Orchestrator CLI docs cover submit, batch, quota, costs commands
- Documentation site index provides navigation
- All docs ready for MkDocs build
</success_criteria>

<output>
After completion, create `.planning/phases/10-release-validation/10-07-SUMMARY.md`
</output>
