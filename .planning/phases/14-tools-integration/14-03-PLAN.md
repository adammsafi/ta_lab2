---
phase: 14-tools-integration
plan: 03
type: execute
wave: 3
depends_on: ["14-02"]
files_modified:
  - src/ta_lab2/tools/data_tools/analysis/generate_function_map.py
  - src/ta_lab2/tools/data_tools/analysis/tree_structure.py
  - src/ta_lab2/tools/data_tools/analysis/__init__.py
autonomous: true

must_haves:
  truths:
    - "Analysis tools migrated with working imports"
    - "No hardcoded absolute paths remain"
    - "Scripts use ta_lab2 patterns (logging, pathlib)"
  artifacts:
    - path: "src/ta_lab2/tools/data_tools/analysis/generate_function_map.py"
      provides: "Function map generation tool"
      exports: ["generate_function_map"]
    - path: "src/ta_lab2/tools/data_tools/analysis/tree_structure.py"
      provides: "Directory tree analysis"
      exports: ["print_tree", "generate_tree_structure"]
  key_links:
    - from: "src/ta_lab2/tools/data_tools/analysis/__init__.py"
      to: "generate_function_map.py"
      via: "import export"
      pattern: "from.*generate_function_map import"
---

<objective>
Migrate analysis tools (generate_function_map, tree_structure) from Data_Tools root

Purpose: Move code analysis utilities used for project introspection. These are self-contained tools with minimal external dependencies (stdlib only).

Output: Working analysis module with importable functions
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14-tools-integration/14-CONTEXT.md
@.planning/phases/14-tools-integration/14-RESEARCH.md
@.planning/phases/14-tools-integration/14-01-SUMMARY.md
@.planning/phases/14-tools-integration/14-02-SUMMARY.md

# Source files
# Read from: C:\Users\asafi\Downloads\Data_Tools\generate_function_map.py
# Read from: C:\Users\asafi\Downloads\Data_Tools\tree_structure.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate generate_function_map.py</name>
  <files>src/ta_lab2/tools/data_tools/analysis/generate_function_map.py</files>
  <action>
Copy and refactor C:\Users\asafi\Downloads\Data_Tools\generate_function_map.py:

1. Read source file
2. Update imports to use absolute ta_lab2 patterns:
   - Remove any sys.path manipulation
   - Use `from pathlib import Path` (not os.path)
   - Add `logging.getLogger(__name__)` for module-level logger

3. Replace hardcoded paths:
   - Any `C:\Users\...` or `/home/...` paths -> use argparse or config.project_root()
   - Output paths -> accept as CLI argument with sensible default

4. Add module docstring explaining purpose and usage

5. Ensure CLI entry point uses argparse pattern:
```python
def main() -> int:
    """CLI entry point."""
    parser = argparse.ArgumentParser(...)
    args = parser.parse_args()
    # ... implementation
    return 0

if __name__ == "__main__":
    raise SystemExit(main())
```

6. Keep core logic (AST parsing, CSV generation) unchanged

Also check generate_function_map_with_purpose.py:
- If it's an enhanced version, migrate that instead (or both if significantly different)
- If duplicate, migrate the more complete one
  </action>
  <verify>
    python -c "from ta_lab2.tools.data_tools.analysis.generate_function_map import generate_function_map"
  </verify>
  <done>generate_function_map.py migrated with working imports and no hardcoded paths</done>
</task>

<task type="auto">
  <name>Task 2: Migrate tree_structure.py</name>
  <files>src/ta_lab2/tools/data_tools/analysis/tree_structure.py</files>
  <action>
Copy and refactor C:\Users\asafi\Downloads\Data_Tools\tree_structure.py:

1. Read source file (note: this file generates multiple outputs: .txt, .md, .json, .csv, API_MAP.md)

2. Update imports:
   - Remove any sys.path manipulation
   - Use pathlib.Path consistently (replace os.path calls)
   - Add module-level logger

3. Replace hardcoded paths:
   - IGNORE_DIRS constant is OK (it's directory names, not paths)
   - Any absolute paths -> CLI arguments or config.project_root()

4. Add comprehensive module docstring:
```python
"""
Directory tree structure generator.

Generates:
- structure.txt: Text tree representation
- structure.md: Markdown tree representation
- structure.json: Hierarchical JSON with metadata
- structure.csv: Flat CSV with file info
- API_MAP.md: Classes and functions per file

Usage:
    python -m ta_lab2.tools.data_tools.analysis.tree_structure /path/to/repo
"""
```

5. Ensure main() function handles CLI arguments properly

6. Core functions to preserve:
   - print_tree()
   - save_tree_markdown()
   - build_tree_json()
   - write_tree_csv()
   - extract_api_map()
  </action>
  <verify>
    python -c "from ta_lab2.tools.data_tools.analysis.tree_structure import print_tree, generate_tree_structure"
  </verify>
  <done>tree_structure.py migrated with all export functions working</done>
</task>

<task type="auto">
  <name>Task 3: Update analysis __init__.py with exports</name>
  <files>src/ta_lab2/tools/data_tools/analysis/__init__.py</files>
  <action>
Update __init__.py to export public functions:

```python
"""
Code analysis tools migrated from Data_Tools.

Tools:
- generate_function_map: Extract function/class signatures to CSV
- tree_structure: Generate directory tree in multiple formats
"""
from ta_lab2.tools.data_tools.analysis.generate_function_map import (
    generate_function_map,
    # Export other public functions as needed
)
from ta_lab2.tools.data_tools.analysis.tree_structure import (
    print_tree,
    generate_tree_structure,
    save_tree_markdown,
    build_tree_json,
)

__all__ = [
    "generate_function_map",
    "print_tree",
    "generate_tree_structure",
    "save_tree_markdown",
    "build_tree_json",
]
```

Verify imports work:
```bash
python -c "from ta_lab2.tools.data_tools.analysis import generate_function_map, print_tree"
```

Commit with message:
```
feat(14): migrate analysis tools from Data_Tools

- generate_function_map.py: AST-based function signature extraction
- tree_structure.py: Directory tree generator (txt/md/json/csv)
- Updated imports to ta_lab2 patterns, removed hardcoded paths
```
  </action>
  <verify>
    python -c "from ta_lab2.tools.data_tools import analysis; print(analysis.__all__)"
  </verify>
  <done>analysis module exports public functions; imports work from package level</done>
</task>

</tasks>

<verification>
- `python -c "from ta_lab2.tools.data_tools.analysis import generate_function_map"` succeeds
- `python -c "from ta_lab2.tools.data_tools.analysis import print_tree"` succeeds
- `grep -r "C:\\\\Users" src/ta_lab2/tools/data_tools/analysis/` returns nothing (no hardcoded paths)
- `grep -r "/home/" src/ta_lab2/tools/data_tools/analysis/` returns nothing
</verification>

<success_criteria>
1. generate_function_map.py migrated with AST parsing intact
2. tree_structure.py migrated with all output formats working
3. No hardcoded absolute paths in either file
4. Both use pathlib.Path and module-level loggers
5. analysis/__init__.py exports public functions
6. Imports work: `from ta_lab2.tools.data_tools.analysis import ...`
</success_criteria>

<output>
After completion, create `.planning/phases/14-tools-integration/14-03-SUMMARY.md`
</output>
