---
phase: 14-tools-integration
plan: 13
type: execute
wave: 2
depends_on: [14-11]
files_modified:
  - tests/tools/data_tools/test_imports_smoke.py
  - src/ta_lab2/tools/data_tools/memory/__init__.py
  - src/ta_lab2/tools/data_tools/generators/__init__.py
  - src/ta_lab2/tools/data_tools/context/__init__.py
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "test_imports_smoke.py includes all 13 new modules in parametrized test"
    - "All smoke tests pass (with pytest.skip for missing optional deps)"
    - "create_reasoning_engine.py import works (memory_bank_engine_rest available)"
    - "Missing docstrings added to flagged modules"
  artifacts:
    - path: "tests/tools/data_tools/test_imports_smoke.py"
      provides: "Parametrized import tests for all 39 modules"
      contains: "generate_memories_from_diffs"
    - path: "src/ta_lab2/tools/data_tools/memory/__init__.py"
      provides: "Complete memory module exports"
      min_lines: 100
  key_links:
    - from: "tests/tools/data_tools/test_imports_smoke.py"
      to: "all data_tools modules"
      via: "importlib.import_module parametrized tests"
      pattern: "ta_lab2.tools.data_tools.memory.generate_memories_from_diffs"
---

<objective>
Update smoke tests and fix import issues to validate the complete Phase 14 migration.

Purpose: Ensure all 38+ migrated scripts pass import validation, add missing docstrings to flagged modules, and verify the import failure in create_reasoning_engine.py is resolved.

Output: Complete test coverage for all migrated modules, passing smoke tests, and clean import validation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-tools-integration/14-09-SUMMARY.md
@.planning/phases/14-tools-integration/14-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update test_imports_smoke.py for all new modules</name>
  <files>
    tests/tools/data_tools/test_imports_smoke.py
  </files>
  <action>
    Update the parametrized import smoke test to include all newly migrated modules:

    1. **Read existing test_imports_smoke.py** (85 lines per VERIFICATION.md)
       - Understand current parametrized test structure
       - Find the module list being tested

    2. **Add new memory modules (10 scripts from 14-11)**:
       - ta_lab2.tools.data_tools.memory.generate_memories_from_diffs
       - ta_lab2.tools.data_tools.memory.generate_memories_from_conversations
       - ta_lab2.tools.data_tools.memory.instantiate_final_memories
       - ta_lab2.tools.data_tools.memory.memory_headers_dedup
       - ta_lab2.tools.data_tools.memory.memory_headers_step1_deterministic
       - ta_lab2.tools.data_tools.memory.memory_headers_step2_openai_enrich
       - ta_lab2.tools.data_tools.memory.memory_instantiate_children_step3
       - ta_lab2.tools.data_tools.memory.memory_bank_engine_rest
       - ta_lab2.tools.data_tools.memory.memory_build_registry
       - ta_lab2.tools.data_tools.memory.combine_memories

    3. **Add new analysis/generators/processing modules (3 scripts from 14-12)**:
       - ta_lab2.tools.data_tools.analysis.generate_function_map_with_purpose
       - ta_lab2.tools.data_tools.generators.generate_commits_txt
       - ta_lab2.tools.data_tools.processing.DataFrame_Consolidation

    Follow existing pattern: pytest.mark.parametrize with pytest.skip() for missing optional dependencies.
  </action>
  <verify>
    pytest tests/tools/data_tools/test_imports_smoke.py -v --tb=short

    All 39 module imports should pass (or skip gracefully for missing deps).
  </verify>
  <done>
    test_imports_smoke.py updated to test all 39 migrated modules with parametrized imports.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add missing docstrings to flagged modules</name>
  <files>
    src/ta_lab2/tools/data_tools/generators/review_generator.py
    src/ta_lab2/tools/data_tools/generators/category_digest_generator.py
    src/ta_lab2/tools/data_tools/generators/intelligence_report_generator.py
    src/ta_lab2/tools/data_tools/generators/finetuning_data_generator.py
    src/ta_lab2/tools/data_tools/generators/review_triage_generator.py
    src/ta_lab2/tools/data_tools/context/ask_project.py
    src/ta_lab2/tools/data_tools/context/query_reasoning_engine.py
  </files>
  <action>
    Add module docstrings to the 8 modules flagged in VERIFICATION.md as missing docstrings:

    **Generators (5 scripts)**:
    1. review_generator.py - Add docstring: "Generate code/project review digests from memory JSONL files."
    2. category_digest_generator.py - Add docstring: "Generate category-based digests from memory collections."
    3. intelligence_report_generator.py - Add docstring: "Generate intelligence reports with indexing from memory JSONL."
    4. finetuning_data_generator.py - Add docstring: "Generate OpenAI fine-tuning datasets from memory collections."
    5. review_triage_generator.py - Add docstring: "Generate review queue triage reports from memory data."

    **Context (2 scripts)**:
    6. ask_project.py - Add docstring: "RAG-based project Q&A with semantic search and LLM chat."
    7. query_reasoning_engine.py - Add docstring: "Query Vertex AI reasoning engine for context-aware responses."

    Note: create_reasoning_engine.py may also need docstring but was not specifically flagged.

    Docstrings should be at module level (triple-quoted string at top of file after imports).
  </action>
  <verify>
    python -c "from ta_lab2.tools.data_tools.generators import review_generator; assert review_generator.__doc__"
    python -c "from ta_lab2.tools.data_tools.context import ask_project; assert ask_project.__doc__"

    All 7 modules have non-None __doc__ attributes.
  </verify>
  <done>
    All 8 flagged modules have module docstrings. Test failures for missing docstrings should now pass.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify create_reasoning_engine.py import and run full test suite</name>
  <files>
    tests/tools/data_tools/test_imports_smoke.py
    tests/tools/data_tools/test_hardcoded_paths.py
  </files>
  <action>
    1. **Verify create_reasoning_engine.py import works**:
       - After 14-11 completes, memory_bank_engine_rest.py should exist
       - create_reasoning_engine.py imports from memory_bank_engine_rest
       - Verify the import chain works: context/create_reasoning_engine.py -> memory/memory_bank_engine_rest.py

    2. **Run full test suite**:
       - pytest tests/tools/data_tools/ -v --tb=short
       - Expected: All 54+ tests pass (or skip for missing deps)
       - Previous: 45/54 passed (83%), 9 failures were docstrings + 1 import

    3. **Run hardcoded path tests on new modules**:
       - pytest tests/tools/data_tools/test_hardcoded_paths.py -v
       - Verify no hardcoded paths in newly migrated scripts

    4. **Document any remaining failures**:
       - If any tests still fail, document the reason
       - Failures due to missing optional dependencies are acceptable (pytest.skip)
  </action>
  <verify>
    pytest tests/tools/data_tools/ -v --tb=short 2>&1 | tail -20

    Expected output: X passed, Y skipped, 0 failed (or documented acceptable failures).
  </verify>
  <done>
    All import smoke tests pass. Hardcoded path tests pass. create_reasoning_engine.py import works. Phase 14 validation complete.
  </done>
</task>

</tasks>

<verification>
1. test_imports_smoke.py tests all 39 modules
2. pytest tests/tools/data_tools/ runs without unexpected failures
3. create_reasoning_engine.py imports successfully
4. All 8 previously flagged modules have docstrings
5. No hardcoded paths detected in new scripts
</verification>

<success_criteria>
- test_imports_smoke.py parametrize list includes all 39 modules
- pytest passes: 50+ tests pass, 0 unexpected failures (skips OK)
- create_reasoning_engine.py import chain works
- All flagged docstring issues resolved
- Phase 14 verification would now score 5/5 must-haves
</success_criteria>

<output>
After completion, create `.planning/phases/14-tools-integration/14-13-SUMMARY.md`
</output>
